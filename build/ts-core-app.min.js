var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(){}return b.prototype.header=function(a,b){return this._headers=this._headers||{},this._headers[a]=b,this},b.prototype.removeHeader=function(a){return delete this._headers[a],this},b.prototype.getHeaders=function(){return this._headers},b.prototype.method=function(a){return this._method=a,this},b.prototype.getMethod=function(){return this._method},b.prototype.url=function(a,b){return this._url=this._interpolateUrl(a,b),this},b.prototype._interpolateUrl=function(a,b){var c=this;return void 0===b&&(b={}),b=b||{},a=a.replace(/(\(\s*|\s*\)|\s*\|\s*)/g,""),a=a.replace(/:([a-z]\w*)/gi,function(a,d){return c._popFirstKey(b,d)||""}),a=a.replace(/(^|[^:])[\/]{2,}/g,"$1/"),a=a.replace(/\/+$/i,"")},b.prototype._popFirstKey=function(a,b){return a.hasOwnProperty(b)?this._popKey(a,b):void 0},b.prototype._popKey=function(a,b){var c=a[b];return delete a[b],c},b.prototype.getUrl=function(){return this._url},b.prototype.data=function(a){return this._data=a,this},b.prototype.getData=function(){return this._data},b.prototype.option=function(a,b){return this._options=this._options||{},this._options[a]=b,this},b.prototype.getOptions=function(){return this._options},b.prototype.param=function(a,b){return this._params=this._params||{},this._params[a]=b,this},b.prototype.getParams=function(){return this._params},b.prototype.getRequestConfig=function(){return _.extend({headers:this.getHeaders(),method:this.getMethod(),url:this.getUrl(),data:this.getData(),params:this.getParams()},this.getOptions())},b.factory=function(){return new b},b.get=function(c,d){var e=new b;return e.method(a.App.Constants.HttpMethods.GET),e.url(c,d),e},b.post=function(c,d,e){var f=new b;return f.method(a.App.Constants.HttpMethods.POST),f.url(c,d),f.data(e),f},b.put=function(c,d,e){var f=new b;return f.method(a.App.Constants.HttpMethods.PUT),f.url(c,d),f.data(e),f},b["delete"]=function(c,d){var e=new b;return e.method(a.App.Constants.HttpMethods.DELETE),e.url(c,d),e},b}();b.RequestOptions=c}(c=b.Http||(b.Http={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b){this.$type="ref",this.value=[a,b]}return a}();a.Reference=b}(b=a.Graph||(a.Graph={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(a){this._data=a||{}}return b.prototype.clear=function(){this._data={}},b.prototype.setData=function(a){this._data=a},b.prototype.getData=function(){return this._data},b.prototype.get=function(a,b){function c(a,b){return a=_.clone(a)||[],a.reverse(),a[b]||null}a=this._optimizePath(a);var d=this._getValueForPath(a),e=c(a,1),f=c(a,0);return this._resolveValueRecursive(e,f,d,b)},b.prototype.setValue=function(){},b.prototype.getValue=function(a){return a=this._optimizePath(a),this._getValueForPath(a)},b.prototype.getGraphForPath=function(a){var c=this,d=new b,e=this.getValue(a);return this._extractReferences(e,function(a){var b=a.value,e=c.getValue(b);e&&d.set(b,e)}),e&&d.set(a,e),d},b.prototype.getGraphForReferences=function(a){var c=this,d=new b;return _.each(a,function(a){var b=c.getGraphForPath(a.value);d.merge(b)}),d},b.prototype._getValueForPath=function(a){for(var b=a?this._data:null,c=a&&a.length?a.length:0,d=0;c>d;d++){var e=a[d];if(void 0===b[e]){b=null;break}b=b[e]}return b},b.prototype._optimizePath=function(a){if(!a)return null;for(var b=this._data,c=0;c<a.length;c++){var d=a[c],e=a.slice(c+1,a.length);if(void 0===b[d]){b=null;break}if(b=b[d],this._isReference(b)){var f=b.value.concat(e);return this._optimizePath(f)}}return b?a:null},b.prototype.set=function(a,b){var c=a;if(a=this._optimizePath(a),a||(a=c),a&&a.length){for(var d=this._data,e=0;e<a.length;e++){var f=a[e];void 0===d[f]&&e!==a.length-1&&(d[f]={}),e===a.length-1&&(d[f]=b),d=d[f]}return this}return this._data=b,this},b.prototype.unset=function(a){if(a=this._optimizePath(a),a&&a.length)for(var b=this._data,c=0;c<a.length;c++){var d=a[c];c===a.length-1&&delete b[d],b=b[d]}return this},b.prototype.hasItem=function(a,b){return!!this._optimizePath([a,b])},b.prototype.setItem=function(a,b,c){this.set([a,b],c)},b.prototype.getItem=function(a,b){return this.get([a,b])},b.prototype.setItems=function(a,b){this.set([a],b)},b.prototype.getItems=function(a){return this.get([a])},b.prototype.countItems=function(a){return this.getItems(a).length},b.prototype.removeItems=function(a){this.unset([a])},b.prototype.removeItem=function(a,b){this.unset([a,b])},b.prototype.getReferences=function(b){return _.map(this._data[b],function(c,d){return new a.Reference(b,d)})},b.prototype.merge=function(a){this.mergeData(a.getData())},b.prototype.mergeData=function(a){var b=this;_.each(a,function(a,c){_.each(a,function(a,d){var e=b.getItem(c,d);e?b.setItem(c,d,_.extend(e,a)):b.setItem(c,d,a)})})},b.prototype._isReference=function(a){return a&&a.$type&&"ref"==a.$type},b.prototype._extractReferences=function(a,b){var c=this;_.isObject(a)&&_.each(a,function(a){if(c._isReference(a)){var d=a;a=c.getValue(d.value),c._extractReferences(a,b),b(d)}else c._extractReferences(a,b)})},b.prototype._resolveValueRecursive=function(a,b,c,d){var e=this;return this._isReference(c)?this.get(c.value,d):(console.log("resolveValueRecursive",c),_.isArray(c)?c=_.map(c,function(a,c){return e._resolveValueRecursive(b,c,a,d)}):_.isObject(c)&&(c=_.mapObject(c,function(a,c){return e._resolveValueRecursive(b,c,a,d)}),this._isResourceName(b)&&(c=_.values(c))),_.isObject(c)&&!_.isArray(c)&&d&&(this._isResourceName(b)?c=d(b,c):this._isResourceName(a)&&(c=d(a,c))),c)},b.prototype._isResourceName=function(a){return void 0!==this._data[a]},b}();a.Graph=b}(b=a.Graph||(a.Graph={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){!function(a){a[a.AND=0]="AND",a[a.OR=1]="OR"}(a.ConditionTypes||(a.ConditionTypes={}));a.ConditionTypes;!function(a){a[a.IS_EQUAL=0]="IS_EQUAL",a[a.IS_GREATER_THAN=1]="IS_GREATER_THAN",a[a.IS_GREATER_THAN_OR_EQUAL=2]="IS_GREATER_THAN_OR_EQUAL",a[a.IS_IN=3]="IS_IN",a[a.IS_LESS_THAN=4]="IS_LESS_THAN",a[a.IS_LESS_THAN_OR_EQUAL=5]="IS_LESS_THAN_OR_EQUAL",a[a.IS_LIKE=6]="IS_LIKE",a[a.IS_NOT_EQUAL=7]="IS_NOT_EQUAL"}(a.ConditionOperators||(a.ConditionOperators={}));var b=(a.ConditionOperators,function(){function a(a,b,c,d){this._type=a,this._field=b,this._operator=c,this._value=d}return a.prototype.getType=function(){return this._type},a.prototype.getField=function(){return this._field},a.prototype.getOperator=function(){return this._operator},a.prototype.getValue=function(){return this._value},a}());a.Condition=b}(b=a.Query||(a.Query={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){!function(a){a[a.ASCENDING=0]="ASCENDING",a[a.DESCENDING=1]="DESCENDING"}(a.SortDirections||(a.SortDirections={}));var b=(a.SortDirections,function(){function a(a,b){this._field=a,this._direction=b}return a.prototype.getField=function(){return this._field},a.prototype.getDirection=function(){return this._direction},a}());a.Sorter=b}(b=a.Query||(a.Query={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a){this._offset=null,this._limit=null,this._fields=[],this._conditions=[],this._sorters=[],this._includes=[],this._executor=a}return a.prototype.executor=function(a){return this._executor=a,this},a.prototype.getExecutor=function(){return this._executor},a.prototype.hasExecutor=function(){return!!this._executor},a.prototype.from=function(a){return this._from=a,this},a.prototype.getFrom=function(){return this._from},a.prototype.hasFrom=function(){return!!this._from},a.prototype.field=function(a){return this._fields.push(a),this},a.prototype.addManyFields=function(a){return this._fields=this._fields.concat(a),this},a.prototype.getFields=function(){return this._fields},a.prototype.hasFields=function(){return this._fields.length>0},a.prototype.offset=function(a){return this._offset=a,this},a.prototype.getOffset=function(){return this._offset},a.prototype.hasOffset=function(){return _.isNumber(this._offset)},a.prototype.limit=function(a){return this._limit=a,this},a.prototype.getLimit=function(){return this._limit},a.prototype.hasLimit=function(){return _.isNumber(this._limit)},a.prototype.condition=function(a){return this._conditions.push(a),this},a.prototype.addManyConditions=function(a){return this._conditions=this._conditions.concat(a),this},a.prototype.getConditions=function(){return this._conditions},a.prototype.hasConditions=function(){return!!(this._conditions.length>0)},a.prototype.sorter=function(a){return this._sorters.push(a),this},a.prototype.addManySorters=function(a){return this._sorters=this._sorters.concat(a),this},a.prototype.getSorters=function(){return this._sorters},a.prototype.hasSorters=function(){return this._sorters.length>0},a.prototype.include=function(a){return this._includes.push(a),this},a.prototype.addManyIncludes=function(a){return this._includes=this._includes.concat(a),this},a.prototype.getIncludes=function(){return this._includes},a.prototype.hasIncludes=function(){return this._includes.length>0},a.prototype.find=function(a){return this._find=a,this},a.prototype.getFind=function(){return this._find},a.prototype.hasFind=function(){return!!this._find},a.prototype.execute=function(){if(!this.hasExecutor())throw"Unable to execute query, no executor set";return this._executor.execute(this)},a.prototype.merge=function(a){return a.hasFrom()&&this.from(a.getFrom()),a.hasFields()&&this.addManyFields(a.getFields()),a.hasOffset()&&this.offset(a.getOffset()),a.hasLimit()&&this.limit(a.getLimit()),a.hasConditions()&&this.addManyConditions(a.getConditions()),a.hasSorters()&&this.addManySorters(a.getSorters()),a.hasIncludes()&&this.addManyIncludes(a.getIncludes()),a.hasFind()&&this.find(a.getFind()),this},a.prototype.serialize=function(a){var b={};return _.contains(a,"from")&&(b.from=this._from),_.contains(a,"conditions")&&(b.conditions=this.getConditions()),_.contains(a,"sorters")&&(b.sorters=this.getSorters()),JSON.stringify(b)},a.from=function(a){return(new this).from(a)},a}();a.Query=b}(b=a.Query||(a.Query={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(b){this.$q=b,this._resources=new a.Data.Dictionary}return b.prototype.setResources=function(a){var b=this;return this._resources=a.clone(),this._resources.each(function(a,c){var d=c.getRequestHandler();d&&(d.setApiService(b),d.setResourceName(a),d.setResource(c))}),this},b.prototype.resource=function(a,b){return this._resources.set(a,b),this},b.prototype.getResource=function(a){return this._resources.get(a)},b.prototype.getResourceAsync=function(b){var c=this.$q.defer(),d=this._resources.get(b);if(!d)throw new a.Exception.Exception("Resource `"+b+"` cannot be found");return c.resolve(d),c.promise},b.prototype.getRequestHandler=function(a){var b=this._resources.get(a);return b?b.getRequestHandler():null},b.prototype.getRequestHandlerAsync=function(a){return this.getResourceAsync(a).then(function(a){return a.getRequestHandler()})},b.prototype.execute=function(a){var b=a.getFrom();return this.getRequestHandlerAsync(b).then(function(b){return b.execute(a)})},b.prototype.all=function(a){return this.getRequestHandlerAsync(a).then(function(a){return a.all()})},b.prototype.find=function(a,b){return this.getRequestHandlerAsync(a).then(function(a){return a.find(b)})},b.prototype.create=function(a,b){return this.getRequestHandlerAsync(a).then(function(a){return a.create(b)})},b.prototype.update=function(a,b,c){return this.getRequestHandlerAsync(a).then(function(a){return a.update(b,c)})},b.prototype.remove=function(a,b){return this.getRequestHandlerAsync(a).then(function(a){return a.remove(b)})},b}();b.Service=c}(c=b.Api||(b.Api={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=a.App.Http.RequestOptions,d=a.Data.List;!function(a){a[a.OFFSET=0]="OFFSET",a[a.LIMIT=1]="LIMIT",a[a.FIELDS=2]="FIELDS",a[a.CONDITIONS=3]="CONDITIONS",a[a.SORTERS=4]="SORTERS",a[a.INCLUDES=5]="INCLUDES"}(b.RequestHandlerFeatures||(b.RequestHandlerFeatures={}));var e=b.RequestHandlerFeatures,f=function(){function a(a,b){this.$q=a,this.httpService=b,this._plugins=new d}return a.prototype.setApiService=function(a){this._apiService=a},a.prototype.getApiService=function(){return this._apiService},a.prototype.setResourceName=function(a){this._resourceName=a},a.prototype.getResourceName=function(){return this._resourceName},a.prototype.setResource=function(a){this._resource=a},a.prototype.getResource=function(){return this._resource},a.prototype.plugin=function(a){return this._plugins.add(a),this},a.prototype.request=function(a){var b=this.getResource().getPrefix(),c=a.getUrl();return a.url(b+c),this.httpService.request(a)},a.prototype.execute=function(a){var b=c.get("/");if(a.hasFind()){var d=a.getFind();b=c.get("/:id",{id:d})}var e=[];this._plugins.each(function(c){e.push(c.execute(b,a))}),e=_.flatten(e);var f=this._getUsedFeatures(a),g=_.difference(f,e);return g.length>0?this.$q.reject():this.request(b)},a.prototype._getUsedFeatures=function(a){var b=[];return a.hasOffset()&&b.push(e.OFFSET),a.hasLimit()&&b.push(e.LIMIT),a.hasFields()&&b.push(e.FIELDS),a.hasConditions()&&b.push(e.CONDITIONS),a.hasSorters()&&b.push(e.SORTERS),a.hasIncludes()&&b.push(e.INCLUDES),b},a.prototype.all=function(){return this.request(c.get("/"))},a.prototype.find=function(a){return this.request(c.get("/:id",{id:a}))},a.prototype.create=function(a){return this.request(c.post("/").data(a))},a.prototype.update=function(a,b){return this.request(c.put("/:id",{id:a}).data(b))},a.prototype.remove=function(a){return this.request(c["delete"]("/:id",{id:a}))},a}();b.RequestHandler=f}(c=b.Api||(b.Api={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(b){function c(){b.apply(this,arguments),this.availableIncludes=[]}return __extends(c,b),c.prototype.transform=function(a){},c.prototype.collection=function(a){var b=this;return a?_.map(a,function(a){return b.item(a)}):null},c.prototype.item=function(b){var c=this;if(!b)return null;var d=this.transform(b);return _.each(this.availableIncludes,function(b){var e="include"+a.Utils.Text.ucFirst(b);d[b]&&c[e]&&(d[b]=c[e](d))}),d},c.collection=function(a){var b=new this;return b.collection(a)},c.item=function(a){var b=new this;return b.item(a)},c}(a.BaseObject);b.Transformer=c}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(b){var c=function(){function b(){}return b.prototype.execute=function(b,c){return c.hasLimit()&&b.param("limit",c.getLimit()),[a.RequestHandlerFeatures.LIMIT]},b}();b.LimitRequestHandlerPlugin=c}(b=a.RequestHandlerPlugins||(a.RequestHandlerPlugins={}))}(b=a.Api||(a.Api={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(b){var c=function(){function b(){}return b.prototype.execute=function(b,c){return c.hasOffset()&&b.param("offset",c.getOffset()),[a.RequestHandlerFeatures.OFFSET]},b}();b.OffsetRequestHandlerPlugin=c}(b=a.RequestHandlerPlugins||(a.RequestHandlerPlugins={}))}(b=a.Api||(a.Api={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a.LOGIN_ATTEMPT_FAIL="login-attempt-fail",a.LOGIN_ATTEMPT_SUCCESS="login-attempt-success",a.LOGIN="login",a.LOGOUT="logout",a.SESSION_SET="session-set",a.SESSION_CLEARED="session-cleared"}(c=b.ManagerEvents||(b.ManagerEvents={}));var d=function(){function b(b){this.$q=b,this.events=new a.Events.EventEmitter,this._accountTypes=new a.Data.Dictionary,this._session=null}return b.prototype.registerAccountType=function(a,b){return this._accountTypes.set(a,b),this},b.prototype.getAccountTypes=function(){return this._accountTypes},b.prototype.getSession=function(){return this._session},b.prototype.setSession=function(a){this._session=a,this.events.trigger(c.SESSION_SET,{session:this._session})},b.prototype.clearSession=function(){var a=this._session;return this._session=null,this.events.trigger(c.SESSION_CLEARED,{session:a}),this},b.prototype.loggedIn=function(){return!!this._session},b.prototype.getAccountType=function(a){return this._accountTypes.get(a)},b.prototype.login=function(b,c){var d=this,e=this._accountTypes.get(b);return e?e.login(c).then(function(b){return d.setSession(b),d.events.trigger(a.App.Auth.ManagerEvents.LOGIN_ATTEMPT_SUCCESS,{credentials:c,session:d.getSession()}),d.events.trigger(a.App.Auth.ManagerEvents.LOGIN,{credentials:c,session:d.getSession()}),d.getSession()})["catch"](function(b){throw d.events.trigger(a.App.Auth.ManagerEvents.LOGIN_ATTEMPT_FAIL,{credentials:c,session:null}),b}):this.$q.reject()},b.prototype.logout=function(a){var b=this,d=this._accountTypes.get(a);return d&&this.loggedIn()?d.logout(this.getSession()).then(function(){b.events.trigger(c.LOGOUT,{session:b.getSession()})})["finally"](function(){b.clearSession()}):this.$q.reject()},b.$inject=["$q"],b}();b.Manager=d}(c=b.Auth||(b.Auth={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a,b,c,d,e){this._accountTypeName=a,this._identity=b,this._startTime=c,this._expirationTime=d,this._token=e}return b.prototype.setIdentity=function(a){this._identity=a},b.prototype.getIdentity=function(){return this._identity},b.prototype.setToken=function(a){this._token=a},b.prototype.getToken=function(){return this._token},b.prototype.setExpirationTime=function(a){this._expirationTime=a},b.prototype.getExpirationTime=function(){return this._expirationTime},b.prototype.setStartTime=function(a){this._startTime=a},b.prototype.getStartTime=function(){return this._startTime},b.prototype.setAccountTypeName=function(a){this._accountTypeName=a},b.prototype.getAccountTypeName=function(){return this._accountTypeName},b.prototype.toJson=function(){return{accountTypeName:this.getAccountTypeName(),identity:this.getIdentity(),startTime:this.getStartTime(),expirationTime:this.getExpirationTime(),token:this.getToken()}},b.fromJson=function(b){return new a.App.Auth.Session(b.accountTypeName,b.identity,b.startTime,b.expirationTime,b.token)},b}();b.Session=c}(c=b.Auth||(b.Auth={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a.GET="GET",a.POST="POST",a.PUT="PUT",a.DELETE="DELETE"}(b=a.HttpMethods||(a.HttpMethods={}))}(b=a.Constants||(a.Constants={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=a.Exception.Exception,d=a.Data.Model;!function(a){a[a.ACTIVATED=0]="ACTIVATED",a[a.CREATED=1]="CREATED",a[a.REMOVED=2]="REMOVED"}(b.ActiveModelFlag||(b.ActiveModelFlag={}));var e=b.ActiveModelFlag,f=function(b){function f(){b.apply(this,arguments),this._flags=new a.Data.Collection}return __extends(f,b),f.prototype.activate=function(a,b){this._dataService=a,this._resourceName=b,this._flags.addMany([e.ACTIVATED,e.CREATED])},f.prototype.deactivate=function(){this._dataService=null,this._resourceName=null,this._flags.removeMany([e.ACTIVATED])},f.prototype.setSavedData=function(a){this._savedData=a},f.prototype.markRemoved=function(){this._flags.add(e.REMOVED)},f.prototype.update=function(a){if(!this.isActivated())throw new c("Unable to update "+this.getResourceIdentifier()+", model is not alive");return this._dataService.updateModel(this._resourceName,this,a)},f.prototype.create=function(a,b,c){return a.createModel(b,this,c)},f.prototype.remove=function(){if(!this.isActivated())throw new c("Unable to remove "+this.getResourceIdentifier()+", model is not alive");return this._dataService.removeModel(this._resourceName,this)},f.prototype.refresh=function(){var a=this;if(!this.isActivated())throw new c("Unable to refresh "+this.getResourceIdentifier()+", model is not alive");return this._dataService.find(this._resourceName,this.getId()).then(function(b){var c=b.data;return c instanceof d&&!a.equals(c)?(a.merge(c),!0):!1})},f.prototype.isActivated=function(){return this._flags.contains(e.ACTIVATED)},f.prototype.isCreated=function(){return this._flags.contains(e.CREATED)},f.prototype.isRemoved=function(){return this._flags.contains(e.REMOVED)},f.prototype.isDirty=function(){return!this._savedData||!this.equals(this._savedData)},f.prototype.getResourceIdentifier=function(){if(!this._resourceName&&!this.getId())return"unknown model";var a="";return this._resourceName&&(a+=this._resourceName),this.getId()&&(a+="("+this.getId()+")"),a},f}(d);b.ActiveModel=f}(c=b.Model||(b.Model={}))}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=a.Data.List,d=a.Data.ModelList,e=a.App.Data.Query.Query,f=a.App.Data.Model.ActiveModel,g=function(){function g(b){this.$q=b,this._sources=new c,this._resources=new a.Data.Dictionary,this._resourceDelegateCache=new a.Data.Dictionary}return g.prototype.source=function(a){return this._sources.add(a),a.setDataService(this),this},g.prototype.getSources=function(){return this._sources.clone()},g.prototype.setResources=function(a){return this._resources=a.clone(),this},g.prototype.resource=function(a,b){return this._resources.set(a,b),this},g.prototype.getResources=function(){return this._resources.clone()},g.prototype.getResource=function(a){return this._resources.get(a)},g.prototype.getResourceAsync=function(b){var c=this.$q.defer(),d=this._resources.get(b);if(!d)throw new a.Exception.Exception("Resource `"+b+"` cannot be found");return c.resolve(d),c.promise},g.prototype.getResourceDelegate=function(a){if(this._resourceDelegateCache.contains(a))return this._resourceDelegateCache.get(a);var c=new b.ResourceDelegate(this,a);return this._resourceDelegateCache.set(a,c),c},g.prototype.query=function(a){return new e(this).from(a)},g.prototype.all=function(a){return this.execute(this.query(a))},g.prototype.find=function(a,b){return this.execute(this.query(a).find(b)).then(function(a){return{response:a.response,data:a.data.first()}})},g.prototype.execute=function(a){var b,c=this;return this._executeSources(function(b){return b.execute(a)}).then(function(d){b=d.response;var e=c._sources.indexOf(d.source);return 0===e?c.$q.when():c._notifySources(e-1,function(c){return c.notifyExecute(a,b)})}).then(function(){return{response:b,data:c._createModels(b)}})},g.prototype._createModels=function(a){var b=this,c=a.graph,e=a.references,g=new d;return _.each(e,function(a){var d=c.get(a.value,function(a,d){var e=b.getResource(a),g=e.getModel(),h=new g(d);return h instanceof f&&(h.activate(b,a),h.setSavedData(c)),h});d&&g.add(d)}),g},g.prototype.create=function(a,b){var c=this;return this._executeCreate(a,b).then(function(a){return{response:a,data:c._createModels(a)[0]||null}})},g.prototype.createModel=function(a,b,c){var d=this;return c&&b.assignAll(c),this._executeCreate(a,b.toObject(!0)).then(function(c){return b=g._updateModel(b,c.references),b instanceof f&&b.activate(d,a),{response:c,data:b}})},g.prototype._executeCreate=function(a,b){var c,d=this;return this._executeSources(function(c){return c.create(a,b)}).then(function(a){c=a.response;var b=d._sources.indexOf(a.source);return 0===b?d.$q.when():d._notifySources(b-1,function(a){return a.notifyCreate(c)})}).then(function(){return c})},g.prototype.update=function(a,b,c){var d=this;return this._executeUpdate(a,b,c).then(function(a){return{response:a,data:d._createModels(a)[0]||null}})},g.prototype.updateModel=function(a,b,c){return this._executeUpdate(a,b.getId(),c||b.toObject(!0)).then(function(a){return g._updateModel(b,a),null})},g.prototype._executeUpdate=function(a,b,c){var d,e=this;return this._executeSources(function(d){return d.update(a,b,c)}).then(function(a){d=a.response;var b=e._sources.indexOf(a.source);return 0===b?e.$q.when():e._notifySources(b-1,function(a){return a.notifyUpdate(d)})}).then(function(){return d})},g.prototype.remove=function(a,b){return this._executeRemove(a,b).then(function(){return null})},g.prototype.removeModel=function(a,b){return this._executeRemove(a,b.getId()).then(function(){return g._removeModel(b),null})},g.prototype._executeRemove=function(a,b){var c,d=this;return this._executeSources(function(c){return c.remove(a,b)}).then(function(a){c=a.response;var b=d._sources.indexOf(a.source);return 0===b?d.$q.when():d._notifySources(b-1,function(a){return a.notifyRemove(c)})}).then(function(){return c})},g.prototype._notifySources=function(a,b){for(var c=[],d=a;d>=0;d--){var e=this._sources.get(d);c.push(b(e))}return this.$q.all(c)},g.prototype._executeSources=function(a){var b=this,c=0,d=this.$q.defer(),e=function(){if(c>=b._sources.count())return void d.reject("No dataSources left");var f=b._sources.get(c);a(f).then(function(a){return d.resolve({response:a,source:f})})["catch"](function(){return e()}),c++};return e(),d.promise},g._updateModel=function(a,b){return a.assignAll(b),a instanceof f&&a.setSavedData(b),a},g._removeModel=function(a){return a instanceof f&&(a.setSavedData(null),a.markRemoved(),a.deactivate()),a},g}();b.Service=g}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(){}return b.prototype.resourceForResourceName=function(a){this._resourceForResourceNameCallback=a},b.prototype.resourceNameForAlias=function(a){this._resourceNameForAliasCallback=a},b.prototype.build=function(b,c){var d=this;void 0===c&&(c=null);var e={};return this._findResourcesRecursive(c,b,function(b,f){var g=d._resourceForResourceNameCallback(c),h=_.clone(f),i={};d._findResources(h,function(b,c,e){var f=d._resourceForResourceNameCallback(c),g=f.getModel().primaryKey(),h=e[g],j=new a.Reference(c,h);b?(i[c]=i[c]||[],i[c].push(j)):i[c]=j}),_.each(i,function(a,b){h[b]=a});var j=g.getModel().primaryKey(),k=h[j];e[b]=e[b]||{},e[b][k]=h}),new a.Graph(e)},b.prototype._findResourcesRecursive=function(a,b,c){var d=this;if(_.isObject(b)){if(a){a=a.toString();var e=this._resourceNameForAliasCallback(a);e&&(_.isArray(b)?_.each(b,function(a){return c(e,a)}):c(e,b))}_.each(b,function(a,b){return d._findResourcesRecursive(b,a,c)})}},b.prototype._findResources=function(a,b){var c=this;_.isObject(a)&&_.each(a,function(a,d){if(_.isObject(a)&&d){var e=d.toString(),f=c._resourceNameForAliasCallback(e);f&&(_.isArray(a)?_.each(a,function(a){return b(!0,f,a)}):b(!1,f,a))}})},b}();a.Builder=b}(b=a.Graph||(a.Graph={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=a.App.Data.Graph.Reference,d=a.App.Data.Graph.Graph,e=a.Exception.Exception,f=function(){function b(b,c,d){this.$q=b,this.apiService=c,this.logger=d,this.logger=(this.logger||new a.Logger.Logger).child("ApiDataSource")}return b.prototype.setDataService=function(a){this._dataService=a},b.prototype.getDataService=function(){return this._dataService},b.prototype.execute=function(a){var b=this;this.logger.info("execute",a);var c=a.getFrom();return this.apiService.execute(a).then(function(a){return b._transformResponse(c,a)})},b.prototype.create=function(a,b){var c=this;return this.logger.info("create"),this.apiService.create(a,b).then(function(b){return c._transformResponse(a,b)})},b.prototype.update=function(a,b,c){var d=this;return this.logger.info("update"),this.apiService.update(a,b,c).then(function(b){return d._transformResponse(a,b)})},b.prototype.remove=function(a,b){var c=this;return this.logger.info("remove"),this.apiService.remove(a,b).then(function(b){return c._transformResponse(a,b)})},b.prototype.notifyExecute=function(a,b){return this.logger.info("notifyExecute - query ",a," - response",b),this.$q.when()},b.prototype.notifyCreate=function(a){return this.logger.info("notifyCreate - response",a),this.$q.when()},b.prototype.notifyUpdate=function(a){return this.logger.info("notifyUpdate - response",a),this.$q.when()},b.prototype.notifyRemove=function(a){return this.logger.info("notifyRemove - response",a),this.$q.when()},b.prototype.clear=function(){return this.$q.when()},b.prototype._transformResponse=function(a,b){var c=this;return this.getDataService().getResourceAsync(a).then(function(d){return c._createDataSourceResponse(a,d,b)})},b.prototype._createDataSourceResponse=function(a,b,d){var e=d.data.total,f=d.data.data,g=d.data.included,h=this._createGraph(f),i=this._createGraph(g);h.merge(i);var j={};return e&&(j.total=e),{meta:j,graph:h,references:_.map(f,function(b){return new c(a,b.id)})}},b.prototype._createGraph=function(a){var b=this,f=new d;return this._extractResource(a,function(a,d,g,h){var i=b.getDataService().getResource(a);if(!i)throw new e("Resource `"+a+"` could not be found!");var j=i.getTransformer(),k=i.getModel(),l=k.primaryKey();g[l]=d;var m=g;j&&(m=j.item(g)),_.each(h,function(a,b){if(_.isArray(a.data))return void(m[b]=_.map(a.data,function(a){var b=a.type,d=a.id;return new c(b,d)}));if(_.isObject(a.data)){var d=a.data,e=d.type,f=d.id;return void(m[b]=new c(e,f))}m[b]=a.data}),f.setItem(a,d,m)}),f},b.prototype._extractResource=function(a,b){_.isArray(a)?_.each(a,function(a){return b(a.type,a.id,a.attributes,a.relationships)}):_.isObject(a)&&b(a.type,a.id,a.attributes,a.relationships)},b.prototype._getResourcesAliasMap=function(){var b=this;if(this._resourceAliasMap)return this._resourceAliasMap;this._resourceAliasMap=new a.Data.Dictionary;var c=this.getDataService().getResources();return c.each(function(a,c){b._resourceAliasMap.set(c.getSingleKey(),a),b._resourceAliasMap.set(c.getMultipleKey(),a)}),this._resourceAliasMap},b}();b.ApiDataSource=f}(c=b.DataSources||(b.DataSources={}))}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=a.App.Data.Graph.Graph,d=(a.App.Data.Graph.Reference,a.Data.DynamicList);!function(a){a[a.DATA_COMPLETE=0]="DATA_COMPLETE"}(b.ResourceFlag||(b.ResourceFlag={}));var e=(b.ResourceFlag,function(){function b(b,d){this.$q=b,this.logger=d,this._graph=new c,this._queryResultMap=new a.Data.Dictionary,this._resourceFlags=new a.Data.Dictionary,this.logger=(this.logger||new a.Logger.Logger).child("MemoryDataSource")}return b.prototype.setDataService=function(a){this._dataService=a},b.prototype.getDataService=function(){return this._dataService},b.prototype.execute=function(a){return this.logger.info("execute"),this.$q.reject()},b.prototype.create=function(a,b){return this.logger.info("create"),this.$q.reject()},b.prototype.update=function(a,b,c){return this.logger.info("update"),this.$q.reject()},b.prototype.remove=function(a,b){return this.logger.info("remove"),this.$q.reject()},b.prototype.notifyExecute=function(a,c){this.logger.info("notifyExecute - query ",a," - response",c),this._graph.merge(c.graph);var e=a.serialize(b.QUERY_SERIALIZE_FIELDS),f=_.clone(c.references),g=a.getOffset()||0;c.meta.total&&this._graph.countItems(a.getFrom())===c.meta.total||!a.hasOffset()&&!a.hasLimit();var h=this._queryResultMap.get(e);return h||(h={meta:c.meta,query:_.clone(a),references:new d}),h.references.setRange(g,f),
console.log("update queryResult",h),this._queryResultMap.set(e,h),this.$q.when()},b.prototype._resourceHasFlag=function(a,b){var c=this._resourceFlags.get(a);return c?c.contains(b):!1},b.prototype._setResourceFlag=function(b,c){console.log("resourceName",b,"flag",c);var d=this._resourceFlags.get(b);d||(d=new a.Data.Collection,this._resourceFlags.set(b,d)),d.add(c)},b.prototype.notifyCreate=function(a){return this.logger.info("notifyCreate - response",a),this.$q.when()},b.prototype.notifyUpdate=function(a){return this.logger.info("notifyUpdate - response",a),this.$q.when()},b.prototype.notifyRemove=function(a){return this.logger.info("notifyRemove - response",a),this.$q.when()},b.prototype.clear=function(){return null},b.QUERY_SERIALIZE_FIELDS=["from","conditions","sorters"],b}());b.MemoryDataSource=e}(c=b.DataSources||(b.DataSources={}))}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b){this._dataService=a,this._resourceName=b}return a.prototype.query=function(){return this._dataService.query(this._resourceName)},a.prototype.all=function(){return this._dataService.all(this._resourceName)},a.prototype.find=function(a){return this._dataService.find(this._resourceName,a)},a.prototype.create=function(a){return this._dataService.create(this._resourceName,a)},a.prototype.createModel=function(a,b){return this._dataService.createModel(this._resourceName,a,b)},a.prototype.update=function(a,b){return this._dataService.update(this._resourceName,a,b)},a.prototype.updateModel=function(a,b){return this._dataService.updateModel(this._resourceName,a,b)},a.prototype.remove=function(a){return this._dataService.remove(this._resourceName,a)},a.prototype.removeModel=function(a){return this._dataService.removeModel(this._resourceName,a)},a}();a.ResourceDelegate=b}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a){this.$http=a,this.defaultHeaders={}}return a.prototype.setProtocol=function(a){this.protocol=a},a.prototype.setHostname=function(a){this.hostname=a},a.prototype.setDefaultHeader=function(a,b){this.defaultHeaders[a]=b},a.prototype.unsetDefaultHeader=function(a){delete this.defaultHeaders[a]},a.prototype.request=function(a){a=this._applyDefaults(a);var b=a.getRequestConfig();return this.$http(b)},a.prototype._applyDefaults=function(a){_.each(this.defaultHeaders,function(b,c){a.header(c,b)});var b=a.getUrl();return a.url(this.protocol+this.hostname+b),a},a}();a.Service=b}(b=a.Http||(a.Http={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.prefix=function(a){return this._prefix=a,this},a.prototype.getPrefix=function(){return this._prefix},a.prototype.singleKey=function(a){return this._singleKey=a,this},a.prototype.getSingleKey=function(){return this._singleKey},a.prototype.multipleKey=function(a){return this._multipleKey=a,this},a.prototype.getMultipleKey=function(){return this._multipleKey},a.prototype.requestHandler=function(a){return this._requestHandler=a,this},a.prototype.getRequestHandler=function(){return this._requestHandler},a.prototype.model=function(a){return this._model=a,this},a.prototype.getModel=function(){return this._model},a.prototype.transformer=function(a){return this._transformer=a,this},a.prototype.getTransformer=function(){return this._transformer},a}();a.Resource=b}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));