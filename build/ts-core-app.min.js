var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(b){function c(){b.apply(this,arguments),this.availableIncludes=[]}return __extends(c,b),c.prototype.transform=function(a){},c.prototype.collection=function(a){var b=this;return a?_.map(a,function(a){return b.item(a)}):null},c.prototype.item=function(b){var c=this;if(!b)return null;var d=this.transform(b);return _.each(this.availableIncludes,function(b){var e="include"+a.Utils.Text.ucFirst(b);d[b]&&c[e]&&(d[b]=c[e](d))}),d},c.collection=function(a){var b=new this;return b.collection(a)},c.item=function(a){var b=new this;return b.item(a)},c}(a.BaseObject);b.Transformer=c}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(){}return b.prototype.header=function(a,b){return this._headers=this._headers||{},this._headers[a]=b,this},b.prototype.removeHeader=function(a){return delete this._headers[a],this},b.prototype.getHeaders=function(){return this._headers},b.prototype.method=function(a){return this._method=a,this},b.prototype.getMethod=function(){return this._method},b.prototype.url=function(a,b){return this._url=this._interpolateUrl(a,b),this},b.prototype._interpolateUrl=function(a,b){var c=this;return void 0===b&&(b={}),b=b||{},a=a.replace(/(\(\s*|\s*\)|\s*\|\s*)/g,""),a=a.replace(/:([a-z]\w*)/gi,function(a,d){return c._popFirstKey(b,d)||""}),a=a.replace(/(^|[^:])[\/]{2,}/g,"$1/"),a=a.replace(/\/+$/i,"")},b.prototype._popFirstKey=function(a,b){return a.hasOwnProperty(b)?this._popKey(a,b):void 0},b.prototype._popKey=function(a,b){var c=a[b];return delete a[b],c},b.prototype.getUrl=function(){return this._url},b.prototype.data=function(a){return this._data=a,this},b.prototype.getData=function(){return this._data},b.prototype.option=function(a,b){return this._options=this._options||{},this._options[a]=b,this},b.prototype.getOptions=function(){return this._options},b.prototype.getRequestConfig=function(){return _.extend({headers:this.getHeaders(),method:this.getMethod(),url:this.getUrl(),data:this.getData()},this.getOptions())},b.factory=function(){return new b},b.get=function(c,d){var e=new b;return e.method(a.App.Constants.HttpMethods.GET),e.url(c,d),e},b.post=function(c,d,e){var f=new b;return f.method(a.App.Constants.HttpMethods.POST),f.url(c,d),f.data(e),f},b.put=function(c,d,e){var f=new b;return f.method(a.App.Constants.HttpMethods.PUT),f.url(c,d),f.data(e),f},b["delete"]=function(c,d){var e=new b;return e.method(a.App.Constants.HttpMethods.DELETE),e.url(c,d),e},b}();b.RequestOptions=c}(c=b.Http||(b.Http={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b){this.$type="ref",this.value=[a,b]}return a}();a.Reference=b}(b=a.Graph||(a.Graph={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a){this._data=a||{}}return a.prototype.clear=function(){this._data={}},a.prototype.get=function(a,b){if(!a)return this._resolveValueRecursive(null,null,this._data,b);if(a=this._optimizePath(a),!a)return null;for(var c=this._data,d=null,e=null,f=0;f<a.length;f++){var g=a[f];if(void 0===c[g]){c=null;break}c=c[g],d=e,e=g}return this._resolveValueRecursive(d,e,c,b)},a.prototype._optimizePath=function(a){if(!a)return null;for(var b=this._data,c=0;c<a.length;c++){var d=a[c],e=a.slice(c+1,a.length);if(void 0===b[d]){b=null;break}if(b=b[d],this._isReference(b)){var f=b.value.concat(e);return this._optimizePath(f)}}return b?a:null},a.prototype.set=function(a,b){var c=a;if(a=this._optimizePath(a),a||(a=c),a&&a.length){for(var d=this._data,e=0;e<a.length;e++){var f=a[e];void 0===d[f]&&e!==a.length-1&&(d[f]={}),e===a.length-1&&(d[f]=b),d=d[f]}return this}return this._data=b,this},a.prototype.unset=function(a){if(a=this._optimizePath(a),a&&a.length)for(var b=this._data,c=0;c<a.length;c++){var d=a[c];c===a.length-1&&delete b[d],b=b[d]}return this},a.prototype.setItem=function(a,b,c){this.set([a,b],c)},a.prototype.getItem=function(a,b){return this.get([a,b])},a.prototype.setItems=function(a,b){this.set([a],b)},a.prototype.getItems=function(a){return this.get([a])},a.prototype.removeItems=function(a){this.unset([a])},a.prototype.removeItem=function(a,b){this.unset([a,b])},a.prototype.merge=function(a){this.mergeData(a.get())},a.prototype.mergeData=function(a){var b=this;_.each(a,function(a,c){_.each(a,function(a,d){var e=b.getItem(c,d);e?b.setItem(c,d,_.extend(e,a)):b.setItem(c,d,a)})})},a.prototype._isReference=function(a){return a&&a.$type&&"ref"==a.$type},a.prototype._resolveValueRecursive=function(a,b,c,d){var e=this;return this._isReference(c)?this.get(c.value,d):(_.isArray(c)?c=_.map(c,function(a,c){return e._resolveValueRecursive(b,c,a,d)}):_.isObject(c)&&(c=_.mapObject(c,function(a,c){return e._resolveValueRecursive(b,c,a,d)}),this._isResourceName(b)&&(c=_.values(c))),!_.isArray(c)&&d&&(this._isResourceName(b)?c=d(b,c):this._isResourceName(a)&&(c=d(a,c))),c)},a.prototype._isResourceName=function(a){return void 0!==this._data[a]},a}();a.Graph=b}(b=a.Graph||(a.Graph={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){!function(a){a[a.AND=0]="AND",a[a.OR=1]="OR"}(a.ConditionTypes||(a.ConditionTypes={}));a.ConditionTypes;!function(a){a[a.IS_EQUAL=0]="IS_EQUAL",a[a.IS_GREATER_THAN=1]="IS_GREATER_THAN",a[a.IS_GREATER_THAN_OR_EQUAL=2]="IS_GREATER_THAN_OR_EQUAL",a[a.IS_IN=3]="IS_IN",a[a.IS_LESS_THAN=4]="IS_LESS_THAN",a[a.IS_LESS_THAN_OR_EQUAL=5]="IS_LESS_THAN_OR_EQUAL",a[a.IS_LIKE=6]="IS_LIKE",a[a.IS_NOT_EQUAL=7]="IS_NOT_EQUAL"}(a.ConditionOperators||(a.ConditionOperators={}));var b=(a.ConditionOperators,function(){function a(a,b,c,d){this._type=a,this._field=b,this._operator=c,this._value=d}return a.prototype.getType=function(){return this._type},a.prototype.getField=function(){return this._field},a.prototype.getOperator=function(){return this._operator},a.prototype.getValue=function(){return this._value},a}());a.Condition=b}(b=a.Query||(a.Query={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){!function(a){a[a.ASCENDING=0]="ASCENDING",a[a.DESCENDING=1]="DESCENDING"}(a.SortDirections||(a.SortDirections={}));var b=(a.SortDirections,function(){function a(a,b){this._field=a,this._direction=b}return a.prototype.getField=function(){return this._field},a.prototype.getDirection=function(){return this._direction},a}());a.Sorter=b}(b=a.Query||(a.Query={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){this._offset=null,this._limit=null,this._fields=[],this._conditions=[],this._sorters=[]}return a.prototype.from=function(a){return this._from=a,this},a.prototype.getFrom=function(){return this._from},a.prototype.hasFrom=function(){return!!this._from},a.prototype.field=function(a){return this._fields.push(a),this},a.prototype.addManyFields=function(a){return this._fields=this._fields.concat(a),this},a.prototype.getFields=function(){return this._fields},a.prototype.hasFields=function(){return this._fields.length>0},a.prototype.offset=function(a){return this._offset=a,this},a.prototype.getOffset=function(){return this._offset},a.prototype.hasOffset=function(){return _.isNumber(this._offset)},a.prototype.limit=function(a){return this._limit=a,this},a.prototype.getLimit=function(){return this._limit},a.prototype.hasLimit=function(){return _.isNumber(this._limit)},a.prototype.condition=function(a){return this._conditions.push(a),this},a.prototype.addManyConditions=function(a){return this._conditions=this._conditions.concat(a),this},a.prototype.getConditions=function(){return this._conditions},a.prototype.hasConditions=function(){return!!(this._conditions.length>0)},a.prototype.sorter=function(a){return this._sorters.push(a),this},a.prototype.addManySorters=function(a){return this._sorters=this._sorters.concat(a),this},a.prototype.getSorters=function(){return this._sorters},a.prototype.hasSorters=function(){return this._sorters.length>0},a.prototype.find=function(a){return this._find=a,this},a.prototype.getFind=function(){return this._find},a.prototype.hasFind=function(){return!!this._find},a.prototype.merge=function(a){return a.hasFrom()&&this.from(a.getFrom()),a.hasFields()&&this.addManyFields(a.getFields()),a.hasOffset()&&this.offset(a.getOffset()),a.hasLimit()&&this.limit(a.getLimit()),a.hasConditions()&&this.addManyConditions(a.getConditions()),a.hasSorters()&&this.addManySorters(a.getSorters()),a.hasFind()&&this.find(a.getFind()),this},a.prototype.serialize=function(a){var b={};return _.contains(a,"from")&&(b.from=this._from),_.contains(a,"conditions")&&(b.conditions=this.getConditions()),_.contains(a,"sorters")&&(b.sorters=this.getSorters()),JSON.stringify(b)},a.from=function(a){return(new this).from(a)},a}();a.Query=b}(b=a.Query||(a.Query={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=a.App.Http.RequestOptions,d=function(){function a(a){this.httpService=a}return a.prototype.setResource=function(a){this._resource=a},a.prototype.getResource=function(){return this._resource},a.prototype.request=function(a){var b=this.getResource().getPrefix(),c=a.getUrl();return a.url(b+c),this.httpService.request(a)},a.prototype.query=function(a){var b=this;return this.request(c.get("/")).then(function(a){return b._transformQuery(a)})},a.prototype.all=function(){var a=this;return this.request(c.get("/")).then(function(b){return a._transformAll(b)})},a.prototype.find=function(a){var b=this;return this.request(c.get("/:id",{id:a})).then(function(a){return b._transformFind(a)})},a.prototype.create=function(a){var b=this;return this.request(c.post("/").data(a)).then(function(a){return b._transformCreate(a)})},a.prototype.update=function(a,b){var d=this;return this.request(c.put("/:id",{id:a}).data(b)).then(function(a){return d._transformUpdate(a)})},a.prototype.remove=function(a){var b=this;return this.request(c["delete"]("/:id",{id:a})).then(function(a){return b._transformRemove(a)})},a.prototype._transformQuery=function(a){return this._transformMultiple(a)},a.prototype._transformAll=function(a){return this._transformMultiple(a)},a.prototype._transformFind=function(a){return this._transformSingle(a)},a.prototype._transformCreate=function(a){return this._transformSingle(a)},a.prototype._transformUpdate=function(a){return this._transformSingle(a)},a.prototype._transformRemove=function(a){return a},a.prototype._transformMultiple=function(a){var b=this.getResource().getTransformer(),c=this.getResource().getMultipleKey();return b.collection(a.data[c])},a.prototype._transformSingle=function(a){var b=this.getResource().getTransformer(),c=this.getResource().getSingleKey();return b.item(a.data[c])},a}();b.RequestHandler=d}(c=b.Api||(b.Api={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(b){this.$q=b,this._resources=new a.Data.Dictionary}return b.prototype.manyResources=function(a){var b=this;return a.each(function(a,c){return b.resource(a,c)}),this},b.prototype.resource=function(a,b){return this[a]=b,this._resources.set(a,b),this._registerRequestHandler(a,b),this},b.prototype._registerRequestHandler=function(a,b){var c=b.getRequestHandler();c.setResource(b),this[a]=c},b.prototype.getResourceAsync=function(b){var c=this.$q.defer(),d=this._resources.get(b);if(!d)throw new a.Exception.Exception("Resource `"+b+"` cannot be found");return c.resolve(d),c.promise},b.prototype._getRequestHandler=function(a){return this.getResourceAsync(a).then(function(a){return a.getRequestHandler()})},b.prototype.execute=function(a){var b=a.getFrom();return a.hasFind()?this.find(b,a.getFind()):this._getRequestHandler(b).then(function(b){return b.query(a)})},b.prototype.all=function(a){return this._getRequestHandler(a).then(function(a){return a.all()})},b.prototype.find=function(a,b){return this._getRequestHandler(a).then(function(a){return a.find(b)})},b.prototype.create=function(a,b){return this._getRequestHandler(a).then(function(a){return a.create(b)})},b.prototype.update=function(a,b,c){return this._getRequestHandler(a).then(function(a){return a.update(b,c)})},b.prototype.remove=function(a,b){return this._getRequestHandler(a).then(function(a){return a.remove(b)})},b}();b.Service=c}(c=b.Api||(b.Api={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a.LOGIN_ATTEMPT_FAIL="login-attempt-fail",a.LOGIN_ATTEMPT_SUCCESS="login-attempt-success",a.LOGIN="login",a.LOGOUT="logout",a.SESSION_SET="session-set",a.SESSION_CLEARED="session-cleared"}(c=b.ManagerEvents||(b.ManagerEvents={}));var d=function(){function b(b){this.$q=b,this.events=new a.Events.EventEmitter,this._accountTypes=new a.Data.Dictionary,this._session=null}return b.prototype.registerAccountType=function(a,b){return this._accountTypes.set(a,b),this},b.prototype.getAccountTypes=function(){return this._accountTypes},b.prototype.getSession=function(){return this._session},b.prototype.setSession=function(a){this._session=a,this.events.trigger(c.SESSION_SET,{session:this._session})},b.prototype.clearSession=function(){var a=this._session;return this._session=null,this.events.trigger(c.SESSION_CLEARED,{session:a}),this},b.prototype.loggedIn=function(){return!!this._session},b.prototype.getAccountType=function(a){return this._accountTypes.get(a)},b.prototype.login=function(b,c){var d=this,e=this._accountTypes.get(b);return e?e.login(c).then(function(b){return d.setSession(b),d.events.trigger(a.App.Auth.ManagerEvents.LOGIN_ATTEMPT_SUCCESS,{credentials:c,session:d.getSession()}),d.events.trigger(a.App.Auth.ManagerEvents.LOGIN,{credentials:c,session:d.getSession()}),d.getSession()})["catch"](function(b){throw d.events.trigger(a.App.Auth.ManagerEvents.LOGIN_ATTEMPT_FAIL,{credentials:c,session:null}),b}):this.$q.reject()},b.prototype.logout=function(a){var b=this,d=this._accountTypes.get(a);return d&&this.loggedIn()?d.logout(this.getSession()).then(function(){b.events.trigger(c.LOGOUT,{session:b.getSession()})})["finally"](function(){b.clearSession()}):this.$q.reject()},b.$inject=["$q"],b}();b.Manager=d}(c=b.Auth||(b.Auth={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a,b,c,d,e){this._accountTypeName=a,this._identity=b,this._startTime=c,this._expirationTime=d,this._token=e}return b.prototype.setIdentity=function(a){this._identity=a},b.prototype.getIdentity=function(){return this._identity},b.prototype.setToken=function(a){this._token=a},b.prototype.getToken=function(){return this._token},b.prototype.setExpirationTime=function(a){this._expirationTime=a},b.prototype.getExpirationTime=function(){return this._expirationTime},b.prototype.setStartTime=function(a){this._startTime=a},b.prototype.getStartTime=function(){return this._startTime},b.prototype.setAccountTypeName=function(a){this._accountTypeName=a},b.prototype.getAccountTypeName=function(){return this._accountTypeName},b.prototype.toJson=function(){return{accountTypeName:this.getAccountTypeName(),identity:this.getIdentity(),startTime:this.getStartTime(),expirationTime:this.getExpirationTime(),token:this.getToken()}},b.fromJson=function(b){return new a.App.Auth.Session(b.accountTypeName,b.identity,b.startTime,b.expirationTime,b.token)},b}();b.Session=c}(c=b.Auth||(b.Auth={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a.GET="GET",a.POST="POST",a.PUT="PUT",a.DELETE="DELETE"}(b=a.HttpMethods||(a.HttpMethods={}))}(b=a.Constants||(a.Constants={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=a.Exception.Exception,d=a.Data.Model;!function(a){a[a.ACTIVATED=0]="ACTIVATED",a[a.CREATED=1]="CREATED",a[a.REMOVED=2]="REMOVED"}(b.ActiveModelFlag||(b.ActiveModelFlag={}));var e=b.ActiveModelFlag,f=function(b){function d(){b.apply(this,arguments),this._flags=new a.Data.Collection}return __extends(d,b),d.prototype.activate=function(a,b){this._dataService=a,this._resourceName=b,this._flags.addMany([e.ACTIVATED,e.CREATED])},d.prototype.deactivate=function(){this._dataService=null,this._resourceName=null,this._flags.removeMany([e.ACTIVATED])},d.prototype.setSavedData=function(a){this._savedData=a},d.prototype.markRemoved=function(){this._flags.add(e.REMOVED)},d.prototype.update=function(a){if(!this.isActivated())throw new c("Unable to update "+this.getResourceIdentifier()+", model is not alive");return this._dataService.updateModel(this._resourceName,this,a)},d.prototype.create=function(a,b,c){return a.createModel(b,this,c)},d.prototype.remove=function(){if(!this.isActivated())throw new c("Unable to remove "+this.getResourceIdentifier()+", model is not alive");return this._dataService.removeModel(this._resourceName,this)},d.prototype.refresh=function(){var a=this;if(!this.isActivated())throw new c("Unable to refresh "+this.getResourceIdentifier()+", model is not alive");return this._dataService.find(this._resourceName,this.getId()).then(function(b){return a.equals(b)?!1:(a.merge(b),!0)})},d.prototype.isActivated=function(){return this._flags.contains(e.ACTIVATED)},d.prototype.isCreated=function(){return this._flags.contains(e.CREATED)},d.prototype.isRemoved=function(){return this._flags.contains(e.REMOVED)},d.prototype.isDirty=function(){return!this._savedData||!this.equals(this._savedData)},d.prototype.getResourceIdentifier=function(){if(!this._resourceName&&!this.getId())return"unknown model";var a="";return this._resourceName&&(a+=this._resourceName),this.getId()&&(a+="("+this.getId()+")"),a},d}(d);b.ActiveModel=f}(c=b.Model||(b.Model={}))}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c=a.Data.List,d=a.App.Data.Query.Query,e=a.App.Data.Model.ActiveModel,f=function(){function b(b){this.$q=b,this._sources=new c,this._resources=new a.Data.Dictionary}return b.prototype.source=function(a){return this._sources.add(a),a.setDataService(this),this},b.prototype.getSources=function(){return this._sources.clone()},b.prototype.manyResources=function(a){var b=this;return a.each(function(a,c){b._resources.set(a,c)}),this},b.prototype.resource=function(a,b){return this[a]=b,this._resources.set(a,b),this},b.prototype.getResources=function(){return this._resources.clone()},b.prototype.getResource=function(a){return this._resources.get(a)},b.prototype.getResourceAsync=function(b){var c=this.$q.defer(),d=this._resources.get(b);if(!d)throw new a.Exception.Exception("Resource `"+b+"` cannot be found");return c.resolve(d),c.promise},b.prototype.query=function(a){return d.from(a)},b.prototype.all=function(a){return this.execute(d.from(a))},b.prototype.find=function(a,b){return this.execute(d.from(a).find(b)).then(function(a){return a[0]||null})},b.prototype.execute=function(a){var b,c=this;return this._executeSources(function(b){return b.execute(a)}).then(function(d){b=d.response;var e=c._sources.indexOf(d.source);return 0===e?c.$q.when():c._notifySources(e-1,function(c){return c.notifyExecute(a,b)})}).then(function(){return c._createModels(b)})},b.prototype._createModels=function(a){var b=this,c=a.data,d=a.results,f=[];return _.each(d,function(a){var d=c.get(a.value,function(a,d){var f=b.getResource(a),g=f.getModel(),h=new g(d);return h instanceof e&&(h.activate(b,a),h.setSavedData(c)),h});d&&f.push(d)}),f},b.prototype.create=function(a,b){var c=this;return this._executeCreate(a,b).then(function(a){return c._createModels(a)[0]||null})},b.prototype.createModel=function(a,c,d){var f=this;return d&&c.assignAll(d),this._executeCreate(a,c.toObject(!0)).then(function(d){return c=b._updateModel(c,d.results),c instanceof e&&c.activate(f,a),c})},b.prototype._executeCreate=function(a,b){var c,d=this;return this._executeSources(function(c){return c.create(a,b)}).then(function(a){c=a.response;var b=d._sources.indexOf(a.source);return 0===b?d.$q.when():d._notifySources(b-1,function(a){return a.notifyCreate(c)})}).then(function(){return c})},b.prototype.update=function(a,b,c){var d=this;return this._executeUpdate(a,b,c).then(function(a){return d._createModels(a)[0]||null})},b.prototype.updateModel=function(a,c,d){return this._executeUpdate(a,c.getId(),d||c.toObject(!0)).then(function(a){return b._updateModel(c,a),null})},b.prototype._executeUpdate=function(a,b,c){var d,e=this;return this._executeSources(function(d){return d.update(a,b,c)}).then(function(a){d=a.response;var b=e._sources.indexOf(a.source);return 0===b?e.$q.when():e._notifySources(b-1,function(a){return a.notifyUpdate(d)})}).then(function(){return d})},b.prototype.remove=function(a,b){return this._executeRemove(a,b).then(function(){return null})},b.prototype.removeModel=function(a,c){return this._executeRemove(a,c.getId()).then(function(){return b._removeModel(c),null})},b.prototype._executeRemove=function(a,b){var c,d=this;return this._executeSources(function(c){return c.remove(a,b)}).then(function(a){c=a.response;var b=d._sources.indexOf(a.source);return 0===b?d.$q.when():d._notifySources(b-1,function(a){return a.notifyRemove(c)})}).then(function(){return c})},b.prototype._notifySources=function(a,b){for(var c=[],d=a;d>=0;d--){var e=this._sources.get(d);c.push(b(e))}return this.$q.all(c)},b.prototype._executeSources=function(a){var b=this,c=0,d=this.$q.defer(),e=function(){if(c>=b._sources.count())return void d.reject("No dataSources left");var f=b._sources.get(c);a(f).then(function(a){return d.resolve({response:a,source:f})})["catch"](function(){return e()}),c++};return e(),d.promise},b._updateModel=function(a,b){return a.assignAll(b),a instanceof e&&a.setSavedData(b),a},b._removeModel=function(a){return a instanceof e&&(a.setSavedData(null),a.markRemoved(),a.deactivate()),a},b}();b.Service=f}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(){}return b.prototype.resourceForResourceName=function(a){this._resourceForResourceNameCallback=a},b.prototype.resourceNameForAlias=function(a){this._resourceNameForAliasCallback=a},b.prototype.build=function(b,c){var d=this;void 0===c&&(c=null);var e={};return this._findResourcesRecursive(c,b,function(b,f){var g=d._resourceForResourceNameCallback(c),h=_.clone(f),i={};d._findResources(h,function(b,c,e){var f=d._resourceForResourceNameCallback(c),g=f.getModel().primaryKey(),h=e[g],j=new a.Reference(c,h);b?(i[c]=i[c]||[],i[c].push(j)):i[c]=j}),_.each(i,function(a,b){h[b]=a});var j=g.getModel().primaryKey(),k=h[j];e[b]=e[b]||{},e[b][k]=h}),new a.Graph(e)},b.prototype._findResourcesRecursive=function(a,b,c){var d=this;if(_.isObject(b)){if(a){a=a.toString();var e=this._resourceNameForAliasCallback(a);e&&(_.isArray(b)?_.each(b,function(a){return c(e,a)}):c(e,b))}_.each(b,function(a,b){return d._findResourcesRecursive(b,a,c)})}},b.prototype._findResources=function(a,b){var c=this;_.isObject(a)&&_.each(a,function(a,d){if(_.isObject(a)&&d){var e=d.toString(),f=c._resourceNameForAliasCallback(e);f&&(_.isArray(a)?_.each(a,function(a){return b(!0,f,a)}):b(!1,f,a))}})},b}();a.Builder=b}(b=a.Graph||(a.Graph={}))}(b=a.Data||(a.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=a.App.Data.Graph.Builder,d=a.App.Data.Graph.Reference,e=function(){function b(a,b,c){this.$q=a,this.logger=b,this.apiService=c,this.logger=this.logger.child("ApiDataSource")}return b.prototype.setDataService=function(a){this._dataService=a},b.prototype.getDataService=function(){return this._dataService},b.prototype.execute=function(a){var b=this;this.logger.info("execute");var c=a.getFrom();return this.apiService.execute(a).then(function(a){return b._transformResponse(c,a)})},b.prototype.create=function(a,b){var c=this;return this.logger.info("create"),this.apiService.create(a,b).then(function(b){return c._transformResponse(a,b)})},b.prototype.update=function(a,b,c){var d=this;return this.logger.info("update"),this.apiService.update(a,b,c).then(function(b){return d._transformResponse(a,b)})},b.prototype.remove=function(a,b){var c=this;return this.logger.info("remove"),this.apiService.remove(a,b).then(function(b){return c._transformResponse(a,b)})},b.prototype.notifyExecute=function(a,b){return this.logger.info("notifyExecute - query ",a," - response",b),this.$q.when()},b.prototype.notifyCreate=function(a){return this.logger.info("notifyCreate - response",a),this.$q.when()},b.prototype.notifyUpdate=function(a){return this.logger.info("notifyUpdate - response",a),this.$q.when()},b.prototype.notifyRemove=function(a){return this.logger.info("notifyRemove - response",a),this.$q.when()},b.prototype.clear=function(){return this.$q.when()},b.prototype._transformResponse=function(a,b){var c=this;return this.getDataService().getResourceAsync(a).then(function(d){return c._createDataSourceResponse(a,d,b)})},b.prototype._createDataSourceResponse=function(a,b,e){var f=this,g=new c;g.resourceForResourceName(function(a){return f._resourceForResourceName(a)}),g.resourceNameForAlias(function(a){return f._resourceNameForAlias(a)});var h=g.build(e,a),i=h.getItems(a),j=b.getModel().primaryKey();return i=_.map(i,function(b,c){return new d(a,b[j])}),{data:h,results:i}},b.prototype._resourceForResourceName=function(a){return this.getDataService().getResource(a)},b.prototype._resourceNameForAlias=function(a){var b=this._getResourcesAliasMap();return b.get(a)},b.prototype._getResourcesAliasMap=function(){var b=this;if(this._resourceAliasMap)return this._resourceAliasMap;this._resourceAliasMap=new a.Data.Dictionary;var c=this.getDataService().getResources();return c.each(function(a,c){b._resourceAliasMap.set(c.getSingleKey(),a),b._resourceAliasMap.set(c.getMultipleKey(),a)}),this._resourceAliasMap},b}();b.ApiDataSource=e}(c=b.DataSources||(b.DataSources={}))}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=a.App.Data.Graph.Graph,d=function(){function b(b,d){this.$q=b,this.logger=d,this._graph=new c,this._queryResultMap=new a.Data.Dictionary,this.logger=this.logger.child("MemoryDataSource")}return b.prototype.setDataService=function(a){this._dataService=a},b.prototype.getDataService=function(){return this._dataService},b.prototype.execute=function(a){this.logger.info("execute");var c=a.serialize(b.QUERY_SERIALIZE_FIELDS),d=this._queryResultMap.get(c);return d?(this.logger.info("resolve cached results"),this.$q.when({data:this._graph,results:_.clone(d.references)})):this.$q.reject()},b.prototype.create=function(a,b){return this.logger.info("create"),this.$q.reject()},b.prototype.update=function(a,b,c){return this.logger.info("update"),this.$q.reject()},b.prototype.remove=function(a,b){return this.logger.info("remove"),this.$q.reject()},b.prototype.notifyExecute=function(a,c){this.logger.info("notifyExecute - query ",a," - response",c);var d=a.serialize(b.QUERY_SERIALIZE_FIELDS);return this._graph.merge(c.data),this._queryResultMap.set(d,{query:_.clone(a),references:_.clone(c.results)}),this.$q.when()},b.prototype.notifyCreate=function(a){return this.logger.info("notifyCreate - response",a),this.$q.when()},b.prototype.notifyUpdate=function(a){return this.logger.info("notifyUpdate - response",a),this.$q.when()},b.prototype.notifyRemove=function(a){return this.logger.info("notifyRemove - response",a),this.$q.when()},b.prototype.clear=function(){return null},b.QUERY_SERIALIZE_FIELDS=["from","conditions","sorters"],b}();b.MemoryDataSource=d}(c=b.DataSources||(b.DataSources={}))}(c=b.Data||(b.Data={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a){this.$http=a,this.defaultHeaders={}}return a.prototype.setProtocol=function(a){this.protocol=a},a.prototype.setHostname=function(a){this.hostname=a},a.prototype.setDefaultHeader=function(a,b){this.defaultHeaders[a]=b},a.prototype.unsetDefaultHeader=function(a){delete this.defaultHeaders[a]},a.prototype.request=function(a){a=this._applyDefaults(a);var b=a.getRequestConfig();return this.$http(b)},a.prototype._applyDefaults=function(a){_.each(this.defaultHeaders,function(b,c){a.header(c,b)});var b=a.getUrl();return a.url(this.protocol+this.hostname+b),a},a}();a.Service=b}(b=a.Http||(a.Http={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a.REQUEST="httpRequest",a.REQUEST_ERROR="httpRequestError",a.RESPONSE="httpResponse",a.RESPONSE_ERROR="httpResponseError",a.RESPONSE_500_ERRORS="httpResponse500Errors",a.RESPONSE_401_ERROR="httpResponseError404"}(c=b.HttpInterceptorEvents||(b.HttpInterceptorEvents={}));var d=function(){function b(b){var d=this;this.$q=b,this.events=new a.Events.EventEmitter,this.request=function(a){return d.events.trigger(c.REQUEST,{config:a}),a},this.requestError=function(a){return d.events.trigger(c.REQUEST_ERROR,{rejection:a}),d.$q.reject(a)},this.response=function(a){return d.events.trigger(c.RESPONSE,{response:a}),a},this.responseError=function(a){return d.events.trigger(c.RESPONSE_ERROR,{rejection:a}),(0===a.status||"5"===String(a.status).charAt(0))&&d.events.trigger(c.RESPONSE_500_ERRORS,{rejection:a}),401===a.status&&d.events.trigger(c.RESPONSE_401_ERROR,{rejection:a}),d.$q.reject(a)}}return b.$inject=["$q"],b}();b.HttpInterceptor=d}(c=b.Interceptors||(b.Interceptors={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a.STATE_CHANGE_START="$stateChangeStart",a.STATE_CHANGE_SUCCESS="$stateChangeSuccess",a.STATE_CHANGE_ERROR="$stateChangeError",a.STATE_NOT_FOUND="$stateNotFound"}(c||(c={}));var d;!function(a){a.PUBLIC="public",a.UNAUTHORIZED="unauthorized",a.AUTHORIZED="authorized"}(d=b.StateAccessLevels||(b.StateAccessLevels={}));var e;!function(a){a.FIRST_ROUTE="firstRoute",a.STATE_CHANGE_START="stateChangeStart",a.ENTERING_AUTHORIZED_AREA="enteringAuthorizedArea",a.ENTERING_UNAUTHORIZED_AREA="enteringUnauthorizedArea",a.ENTERING_PUBLIC_AREA="enteringPublicArea"}(e=b.StateInterceptorEvents||(b.StateInterceptorEvents={}));var f=function(){function b(b){this.$rootScope=b,this.events=new a.Events.EventEmitter,this._firstRoute=null,this._lastRoute=null}return b.prototype.init=function(){this._attachRouterEvents()},b.prototype._attachRouterEvents=function(){this.$rootScope.$on(c.STATE_CHANGE_START,_.bind(this._$stateChangeStart,this))},b.prototype._$stateChangeStart=function(a,b,c,f,g){var h={event:a,toState:b,toParams:c,fromState:f,fromParams:g};if(!f||f.accessLevel!==b.accessLevel){var i;switch(b.accessLevel){case d.AUTHORIZED:i=e.ENTERING_AUTHORIZED_AREA;break;case d.PUBLIC:i=e.ENTERING_PUBLIC_AREA;break;default:case d.UNAUTHORIZED:i=e.ENTERING_UNAUTHORIZED_AREA}this.events.trigger(i,h)}this._lastRoute={toState:b,toParams:c},this._firstRoute||(this._firstRoute=this._lastRoute,this.events.trigger(e.FIRST_ROUTE,h)),this.events.trigger(e.STATE_CHANGE_START,h)},b.prototype.getFirstRoute=function(){return this._firstRoute},b.$inject=["$rootScope"],b}();b.StateInterceptor=f;
}(c=b.Interceptors||(b.Interceptors={}))}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));var TSCore;!function(a){var b;!function(a){var b=function(){function a(){}return a.prototype.prefix=function(a){return this._prefix=a,this},a.prototype.getPrefix=function(){return this._prefix},a.prototype.singleKey=function(a){return this._singleKey=a,this},a.prototype.getSingleKey=function(){return this._singleKey},a.prototype.multipleKey=function(a){return this._multipleKey=a,this},a.prototype.getMultipleKey=function(){return this._multipleKey},a.prototype.requestHandler=function(a){return this._requestHandler=a,this},a.prototype.getRequestHandler=function(){return this._requestHandler},a.prototype.model=function(a){return this._model=a,this},a.prototype.getModel=function(){return this._model},a.prototype.transformer=function(a){return this._transformer=a,this},a.prototype.getTransformer=function(){return this._transformer},a}();a.Resource=b}(b=a.App||(a.App={}))}(TSCore||(TSCore={}));